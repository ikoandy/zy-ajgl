<!--pages/messages/detail/detail.wxml-->
<view class="message-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <block wx:if="{{loading}}">
    <view class="loading">
      <van-loading type="spinner" size="36px" color="#1a365d" />
      <text>åŠ è½½ä¸­...</text>
    </view>
  </block>
  
  <!-- æ¶ˆæ¯è¯¦æƒ… -->
  <block wx:else>
    <!-- æ¶ˆæ¯å¤´éƒ¨ -->
    <view class="section">
      <view class="message-header">
        <view class="sender-avatar">
          <text class="avatar-text">{{message.clientName.charAt(0)}}</text>
        </view>
        <view class="sender-info">
          <text class="sender-name">{{message.clientName}}</text>
          <view class="message-meta">
            <text class="message-time">{{message.createTime}}</text>
            <view class="status-badge {{message.isRead ? 'read' : 'unread'}}">
              {{message.isRead ? 'å·²è¯»' : 'æœªè¯»'}}
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ¶ˆæ¯å†…å®¹ -->
      <view class="message-content">
        {{message.content}}
      </view>
      
      <!-- æ¶ˆæ¯é™„ä»¶ -->
      <block wx:if="{{message.attachments && message.attachments.length > 0}}">
        <view class="message-attachments">
          <view 
            wx:for="{{message.attachments}}" 
            wx:key="id" 
            class="attachment-item"
            bindtap="handleDownloadAttachment"
            data-id="{{item.id}}"
          >
            <view class="attachment-icon">ğŸ“</view>
            <view class="attachment-info">
              <text class="attachment-name">{{item.name}}</text>
              <text class="attachment-size">{{item.size}}</text>
            </view>
          </view>
        </view>
      </block>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <view class="action-btn btn-secondary" bindtap="handleBackToList">
          è¿”å›åˆ—è¡¨
        </view>
        <view class="action-btn btn-primary" bindtap="handleReply">
          å›å¤æ¶ˆæ¯
        </view>
      </view>
    </view>
    
    <!-- å†å²æ¶ˆæ¯ -->
    <block wx:if="{{historyMessages && historyMessages.length > 0}}">
      <view class="history-messages">
        <view class="history-header">
          <text class="history-title">å†å²æ¶ˆæ¯</text>
        </view>
        <view class="history-list">
          <view 
            wx:for="{{historyMessages}}" 
            wx:key="id" 
            class="history-item {{item.senderType === 'client' ? 'received' : 'sent'}}"
          >
            <view class="history-bubble">
              <text class="history-sender">{{item.sender}}</text>
              <text class="history-content">{{item.content}}</text>
              <text class="history-time">{{item.createTime}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- å›å¤åŒºåŸŸ -->
    <view class="reply-section">
      <view class="reply-header">
        <text class="reply-title">å›å¤æ¶ˆæ¯</text>
      </view>
      <form class="reply-form" bindsubmit="handleSendReply">
        <textarea 
          class="reply-textarea" 
          placeholder="è¯·è¾“å…¥å›å¤å†…å®¹..." 
          placeholder-class="placeholder" 
          value="{{replyContent}}" 
          bindinput="handleReplyInput"
          auto-height
        ></textarea>
        <view class="reply-actions">
          <button class="action-btn btn-secondary" type="button" bindtap="handleCancelReply">
            å–æ¶ˆ
          </button>
          <button class="action-btn btn-primary" type="submit">
            å‘é€
          </button>
        </view>
      </form>
    </view>
  </block>
</view>