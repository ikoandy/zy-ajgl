<!-- pages/clients/list/list.wxml -->
<view class="clients-container">
  <!-- 搜索和筛选卡片 -->
  <view class="search-filter-card">
    <!-- 搜索栏 -->
    <view class="search-bar">
      <view class="search-input">
        <view class="search-icon">搜</view>
        <input 
          class="input" 
          placeholder="搜索客户姓名、电话..." 
          placeholder-class="placeholder" 
          value="{{keyword}}" 
          bindinput="handleSearch"
          bindconfirm="handleSearchConfirm"
        ></input>
        <view 
          wx:if="{{keyword}}" 
          class="clear-icon" 
          bindtap="handleClearSearch"
        >×</view>
      </view>
      <view 
        class="create-icon" 
        bindtap="goToCreate"
      >+</view>
      <view 
        class="filter-icon" 
        bindtap="toggleFilter"
      >设</view>
    </view>

    <!-- 状态筛选 -->
    <scroll-view scroll-x="true" enable-flex class="status-filter">
      <view 
        wx:for="{{statusOptions}}" 
        wx:key="value" 
        class="filter-item {{filters.status === item.value ? 'active' : ''}}" 
        bindtap="handleFilter" 
        data-status="{{item.value}}"
      >
        {{item.label}}
      </view>
    </scroll-view>
  </view>

  <!-- 客户列表 -->
  <view class="client-list">
    <block wx:if="{{loading && clients.length === 0}}">
      <!-- 骨架屏 -->
      <view class="skeleton-container">
        <view class="skeleton-client-item" wx:for="[1,2,3,4,5]" wx:key="index">
          <view class="skeleton-client-avatar"></view>
          <view class="skeleton-client-info">
            <view class="skeleton-client-name-section">
              <view class="skeleton-client-name"></view>
              <view class="skeleton-status-badge"></view>
            </view>
            <view class="skeleton-client-meta">
              <view class="skeleton-client-phone"></view>
              <view class="skeleton-client-email"></view>
            </view>
            <view class="skeleton-client-stats">
              <view class="skeleton-stat-label"></view>
              <view class="skeleton-stat-value"></view>
              <view class="skeleton-last-contact"></view>
            </view>
          </view>
          <view class="skeleton-arrow"></view>
        </view>
      </view>
    </block>
    <block wx:elif="{{clients.length === 0}}">
      <view class="empty">
        <text>暂无客户</text>
        <button class="create-button" bindtap="goToCreate">添加客户</button>
      </view>
    </block>
    <block wx:else>
      <view 
        wx:for="{{clients}}" 
        wx:key="id" 
        class="client-item" 
        bindtap="goToDetail" 
        data-id="{{item.id}}"
      >
        <view class="client-avatar">
          <text class="avatar-text">{{item.name.charAt(0)}}</text>
        </view>
        <view class="client-info">
          <view class="client-name-section">
            <text class="client-name">{{item.name}}</text>
            <view class="status-badge {{item.status}}">
              {{item.status === 'active' ? '活跃' : item.status === 'inactive' ? '不活跃' : '新客户'}}
            </view>
          </view>
          <view class="client-meta">
            <text class="client-phone">{{item.phone}}</text>
            <text class="client-email">{{item.email}}</text>
          </view>
          <view class="client-stats">
            <view class="stat-item">
              <text class="stat-label">案件数：</text>
              <text class="stat-value">{{item.caseCount || 0}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">上次联系：</text>
              <text class="stat-value">{{item.lastContact || '暂无'}}</text>
            </view>
          </view>
        </view>
        <view class="arrow-icon">→</view>
      </view>
      
      <view wx:if="{{loading && clients.length > 0}}" class="loading-more">
        <van-loading type="spinner" size="28px" color="var(--primary-color)" />
        <text>加载更多...</text>
      </view>
      <view wx:else-if="{{!hasMore}}" class="no-more">
        <text>没有更多了</text>
      </view>
    </block>
  </view>

  <!-- 筛选面板 -->
  <view class="filter-panel" wx:if="{{filterVisible}}">
    <view class="filter-header">
      <text class="filter-title">筛选条件</text>
      <view 
        class="close-icon" 
        bindtap="toggleFilter"
      >×</view>
    </view>
    
    <view class="filter-content">
      <!-- 排序方式 -->
      <view class="filter-section">
        <text class="section-title">排序方式</text>
        <view class="filter-options">
          <view 
            class="option-item {{filters.sortBy === 'updateTime' ? 'active' : ''}}" 
            bindtap="handleFilterChange" 
            data-field="sortBy" 
            data-value="updateTime"
          >
            最近更新
          </view>
          <view 
            class="option-item {{filters.sortBy === 'createTime' ? 'active' : ''}}" 
            bindtap="handleFilterChange" 
            data-field="sortBy" 
            data-value="createTime"
          >
            创建时间
          </view>
          <view 
            class="option-item {{filters.sortBy === 'name' ? 'active' : ''}}" 
            bindtap="handleFilterChange" 
            data-field="sortBy" 
            data-value="name"
          >
            姓名排序
          </view>
        </view>
      </view>
    </view>
    
    <view class="filter-footer">
      <button class="reset-button" bindtap="handleFilterReset">重置</button>
      <button class="confirm-button" bindtap="handleFilterConfirm">确认</button>
    </view>
  </view>


</view>
