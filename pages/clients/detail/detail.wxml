<!--pages/clients/detail/detail.wxml-->
<view class="client-detail-container">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 客户详情内容 -->
  <view wx:elif="{{clientInfo}}">
    <!-- 客户基本信息卡片 -->
    <view class="client-header-card">
      <view class="client-basic-info">
        <view class="client-title-section">
          <text class="client-name">{{clientInfo.name}}</text>
          <view class="client-status {{clientInfo.status}}">
            {{clientInfo.status === 'new' ? '新客户' : clientInfo.status === 'active' ? '活跃' : '不活跃'}}
          </view>
        </view>
        <view class="client-contact-info">
          <text class="client-contact">{{clientInfo.phone}}</text>
          <text class="client-contact">{{clientInfo.email}}</text>
        </view>
      </view>
      
      <!-- 统计数据 -->
      <view class="client-stats">
        <view class="stat-item">
          <text class="stat-value">{{cases.length}}</text>
          <text class="stat-label">案件数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{followRecords.length}}</text>
          <text class="stat-label">跟进记录</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{clientInfo.caseCount || 0}}</text>
          <text class="stat-label">总案件</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button class="action-button" bindtap="handleCall">
        <view class="button-icon-circle">
          <text class="button-icon-text">电</text>
        </view>
        <text class="button-text">打电话</text>
      </button>
      <button class="action-button" bindtap="handleSendMessage">
        <view class="button-icon-circle">
          <text class="button-icon-text">信</text>
        </view>
        <text class="button-text">发消息</text>
      </button>
      <button class="action-button" bindtap="handleAddFollow">
        <view class="button-icon-circle">
          <text class="button-icon-text">记</text>
        </view>
        <text class="button-text">添加跟进</text>
      </button>
    </view>

    <!-- 标签切换 -->
    <view class="tab-container">
      <view class="tab-bar">
        <view 
          class="tab-item {{activeTab === 'info' ? 'active' : ''}}" 
          bindtap="handleTabChange" 
          data-tab="info"
        >
          基本信息
        </view>
        <view 
          class="tab-item {{activeTab === 'cases' ? 'active' : ''}}" 
          bindtap="handleTabChange" 
          data-tab="cases"
        >
          案件列表
        </view>
        <view 
          class="tab-item {{activeTab === 'follow' ? 'active' : ''}}" 
          bindtap="handleTabChange" 
          data-tab="follow"
        >
          跟进记录
        </view>
      </view>

      <!-- 标签内容 -->
      <view class="tab-content">
        <!-- 基本信息标签 -->
        <view wx:if="{{activeTab === 'info'}}">
          <view class="info-section">
            <view class="section-title">基本信息</view>
            <view class="section-content">
              <view class="detail-item">
                <text class="detail-label">客户类型</text>
                <text class="detail-value">{{clientInfo.type === 'individual' ? '个人' : '企业'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">创建时间</text>
                <text class="detail-value">{{clientInfo.createdAt || '未知'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">最后联系</text>
                <text class="detail-value">{{clientInfo.lastContact || '从未联系'}}</text>
              </view>
              <view class="detail-item">
                <text class="detail-label">备注</text>
                <text class="detail-value">{{clientInfo.remark || '无'}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- 案件列表标签 -->
        <view wx:elif="{{activeTab === 'cases'}}" class="cases-section">
          <view class="section-header">
            <text class="section-title">案件列表</text>
          </view>
          <view class="cases-list">
            <block wx:if="{{cases.length > 0}}">
              <view wx:for="{{cases}}" wx:key="id" class="case-item">
                <view class="case-info">
                  <text class="case-title">{{item.title}}</text>
                  <text class="case-meta">{{item.createdAt}}</text>
                </view>
                <view class="case-status {{item.status}}">
                  {{item.status === 'pending' ? '待处理' : item.status === 'processing' ? '进行中' : '已完成'}}
                </view>
              </view>
            </block>
            <block wx:else>
              <view class="empty">
                <text>暂无案件记录</text>
              </view>
            </block>
          </view>
        </view>

        <!-- 跟进记录标签 -->
        <view wx:elif="{{activeTab === 'follow'}}" class="follow-section">
          <view class="section-header">
            <text class="section-title">跟进记录</text>
          </view>
          <view class="follow-list">
            <block wx:if="{{followRecords.length > 0}}">
              <view wx:for="{{followRecords}}" wx:key="id" class="follow-item">
                <view class="follow-dot"></view>
                <view class="follow-content">
                  <view class="follow-header">
                    <text class="follow-type">{{item.type === 'call' ? '电话' : item.type === 'meeting' ? '会议' : '其他'}}</text>
                    <text class="follow-time">{{item.date}}</text>
                  </view>
                  <view class="follow-details">{{item.content}}</view>
                </view>
              </view>
            </block>
            <block wx:else>
              <view class="empty">
                <text>暂无跟进记录</text>
              </view>
            </block>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 数据加载失败状态 -->
  <view wx:else>
    <view class="empty">
      <text>加载失败，请重试</text>
    </view>
  </view>
</view>